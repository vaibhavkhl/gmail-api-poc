"use strict";angular.module("gmailAppApp",["ngResource","ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).otherwise({redirectTo:"/"})}]),angular.module("gmailAppApp").controller("MainCtrl",["$scope","$filter",function(a,b){function c(){gapi.auth.authorize({client_id:m,scope:n,immediate:!0},d)}function d(b){b&&!b.error?(console.log("authorized"),a.isAuthorized=!0,e()):(console.log("not authorized"),a.isAuthorized=!1,a.$apply())}function e(){gapi.client.load("gmail","v1",f)}function f(){console.log("loading data"),g()}function g(){var b=gapi.client.gmail.users.labels.list({userId:"me"});b.execute(function(b){a.labels=b.labels,a.$apply()})}function h(){if(a.param.start_date)var c="after:"+b("date")(a.param.start_date,"yyyy/MM/dd");if(a.param.end_date)var d="before:"+b("date")(a.param.end_date,"yyyy/MM/dd");if(a.param.from)var e="from:"+a.param.from;if(e)var f=c+d+e;else var f=c+d;return encodeURI(f.toString())}function i(b){a.messages.length=0,_.each(b.slice(0,9),function(a){gapi.client.gmail.users.messages.get({userId:"me",id:a.id}).then(function(a){j(a)})})}function j(b){var c={};c.from=o(b.result,"FROM"),c.subject=o(b.result,"SUBJECT"),c.date=o(b.result,"DATE"),c.id=b.result.id,k(b.result),a.messages.push(c),a.$apply()}function k(a){var b=a.payload.parts;_.each(b,function(b){if(b.filename&&b.filename.length>0){var c=b.body.attachmentId,d=gapi.client.gmail.users.messages.attachments.get({id:c,messageId:a.id,userId:"me"});d.then(function(c){l(a.id,b.filename),console.log("attachement",c)})}})}function l(b,c){_.each(a.messages,function(d){d.id==b&&(d.attachmentName=c,a.$apply())})}var m="1042316795013-09puaanar8ickpkeq1cnlnp7m3il9p16.apps.googleusercontent.com",n=["https://www.googleapis.com/auth/gmail.readonly"];a.isAuthorized=!0,a.messages=[],a.authorize=function(){return gapi.auth.authorize({client_id:m,scope:n,immediate:!1},d),!1},c(),a.searchMsg=function(){var a=h(),b=gapi.client.gmail.users.messages.list({userId:"me",q:a});b.then(function(a){i(a.result.messages)})},a.getMsgsForLabel=function(a){var b=gapi.client.gmail.users.messages.list({userId:"me",labelIds:a});b.execute(function(a){i(a.messages)})};var o=function(a,b){var c=_.find(a.payload.headers,function(a){return a.name.toLowerCase()===b.toLowerCase()});return c.value}}]),angular.module("gmailAppApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("gmailAppApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/main.html",'<div ng-show="!isAuthorized"> <span>Authorize access to Gmail API</span> <!--Button for the user to click to initiate auth sequence --> <button ng-click="authorize()" class="btn"> Authorize </button> </div> <div class="row search panel-body"> <h3>Search</h3> Start Date: <input type="date" ng-model="param.start_date"> End Date: <input type="date" ng-model="param.end_date"> From: <input type="search" ng-model="param.from"> <button class="btn" type="submit" ng-click="searchMsg()">Search</button> </div> <div> <div class="row label-panel"> <div class="col-md-3"> <h3>Labels:</h3> <div ng-repeat="label in labels" ng-click="getMsgsForLabel(label.id)">{{label.name.toUpperCase()}}</div> </div> <div class="col-md-8 msgs-panel"> <h3>Messages </h3> <table class="table"> <thead> <tr> <td>From</td> <td>Subject</td> <td>Date</td> <td>Attachment</td> </tr> </thead> <tbody> <tr ng-repeat="msg in messages"> <td>{{msg.from}}</td> <td>{{msg.subject}}</td> <td>{{msg.date}}</td> <td>{{msg.attachmentName}}</td> </tr> </tbody> </table> </div> </div> </div>')}]);